# .github/workflows/esp-idf-ci.yml
name: ESP-IDF v5.5.x 自动编译

# 触发条件：当推送以v开头的tag时触发（如v1.0、v2.5.0、v5.5.1等）
on:
  push:
    tags: ['v*']

# 要执行的任务
jobs:
  build:
    # 在最新的 Ubuntu 系统上运行
    runs-on: ubuntu-latest

    steps:
      # 步骤1: 拉取代码到云端服务器
      - name: 拉取代码
        uses: actions/checkout@v4
        with:
          submodules: 'recursive'  # 如果项目有子模块，必须加上这行

      # 步骤2: 使用ESP-IDF构建
      - name: 使用ESP-IDF v5.5构建
        uses: espressif/esp-idf-ci-action@v1
        with:
          esp_idf_version: 'v5.5' # 指定使用 ESP-IDF v5.5.x 版本
          target: esp32c3

      # 步骤3: 上传编译好的固件作为构建产物，方便下载
      - name: 上传固件产物
        uses: actions/upload-artifact@v4
        with:
          name: esp32-firmware  # 产物包的名称，可以自定义
          path: |
            build/*.bin
            build/*.elf
            build/*.map
